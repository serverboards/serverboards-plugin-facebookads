id: serverboards.facebookads
name: Facebook Ads Integration
description: |
  Provides access to metrics from facebook ads.
author: David Moreno <dmoreno@serverboards.io>
version: 17.04


components:
  - id: service
    type: service
    name: Facebook Ads
    icon: facebook
    traits: facebookads cloud
    description: |
      Access to facebook ads data via the Facebook API. Needs to configure your
      own access tokens and provide them here.

      To be able to get all this data you need to subscribe as a Facebook
      developer and create an app.
    fields:
      - name: app_id
        label: App ID
        type: text
      - name: app_secret
        label: App Secret
        type: password
      - name: access_token
        label: Access Token
        description: The access token can be obtained at the Marketing API at the [app dashboard](https://developers.facebook.com/apps/).
        placeholder: " "
        type: text

  - id: widget
    type: widget
    name: Facebook Insights
    icon: facebook
    description: |
      Show an snapshot of the facebook insights for the selected period.
    params:
      - name: service
        label: Facebook Service
        type: service
        traits: facebookads
      - name: insight
        label: Insight
        type: select call
        options:
          command: serverboards.facebookads/command
          call: get_possible_insights
      - name: type
        label: Type of graph
        type: select
        options:
          - name: Sum of data
            value: sum
          - name: Evolution of data
            value: evolution

  - id: command
    type: cmd
    command: ./sbds_facebook_ads.py
    strategy: singleton
    timeout: 10s
    name: Facebook Ads API Connector
    perms:
      - rules.view
      - rules.trigger

  - id: trigger
    type: trigger
    name: Facebook Ads
    description: Watches for some conditions on the Facebook Ads data.
    traits: facebookads cloud
    states: ok nok
    start:
      params:
        - name: service
          label: Facebook Service
          type: service
          traits: facebookads
        - name: insight
          label: Insight
          type: select call
          options:
            command: serverboards.facebookads/command
            call: get_possible_insights
        - name: field
          label: Field
          type: select
          options:
            - value: call_to_action_clicks
              name: Call to action Clicks
            - value: impressions
              name: Impressions
            - value: website_clicks
              name: Website Clicks
            - value: social_clicks
              name: Social Clicks
            - value: ctr
              name: CTR
            - value: canvas_avg_view_percent
              name: Canvas Averag View Percent
        - name: condition
          label: Condition
          type: select
          options:
            - name: Greater
              value: ">"
            - name: Less
              value: "<"
            - name: Greater or equal
              value: ">="
            - name: Less or equal
              value: "<="
        - name: value
          label: Value
          type: text

  - id: rules_cron
    type: cron
    name: Trigger Cron
    description: Checks every morning for the Facebook Ads rules.
    cron: 00 8 * * *
    action: serverboards.facebookads/check_rules
    params: {}

  - id: check_rules
    type: action
    name: Check Facebook Ads Rules
    command: command
    call:
      method: check_rules
    traits: facebookads hidden
